import{V as e,m as a,$ as l}from"./server.mjs";import{computed as u,readonly as r}from"file://F:/TravelinAgency/node_modules/vue/index.mjs";const _=()=>{const o=e("auth.user",{default:()=>null,maxAge:604800,sameSite:"lax",secure:!1}),s=a("auth.user",(()=>o.value)),t=a("auth.loading",(()=>!1)),i=a("auth.error",(()=>"")),n=e=>!(!s.value||!s.value.role)&&(Array.isArray(e)?e.includes(s.value.role):s.value.role===e),c=u((()=>n(["admin","super_admin","moderator"]))),v=u((()=>n("super_admin"))),d=u((()=>{var e;return null!=(e=s.value)&&e.full_name?s.value.full_name.split(" ").map((e=>e.charAt(0))).slice(0,2).join("").toUpperCase():"AD"}));return{user:r(s),loading:r(t),error:r(i),isAdmin:c,isSuperAdmin:v,userInitials:d,login:async(e,a)=>{var l;t.value=!0,i.value="";try{const l=await $fetch("/api/auth/login",{method:"POST",body:{email:e,password:a}});if(l.success&&l.data.user&&l.data.token)return s.value=l.data.user,o.value=l.data.user,{success:!0};throw new Error("Invalid response from server")}catch(e){return console.error("Login error:",e),null!=(l=e.data)&&l.message?i.value=e.data.message:"Invalid login credentials"===e.message?i.value="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©":i.value="Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",{success:!1,error:i.value}}finally{t.value=!1}},logout:async()=>{try{const e=await $fetch("/api/auth/logout",{method:"POST"});console.log("Logout response:",e.message)}catch(e){console.error("Logout error:",e)}finally{s.value=null,o.value=null;e("auth-token").value=null,await l("/admin/login")}},checkAuth:async(a=!1)=>{if(s.value)return a||console.log("ðŸ‘¤ User already in state:",s.value.email,"role:",s.value.role),s.value;const l=e("auth-token");if(!l.value)return a||console.log("ðŸ” No auth token found in cookie"),s.value=null,null;try{a||console.log("ðŸ” Fetching user data from API...");const e=await $fetch("/api/auth/me");return e.success&&e.data.user?(s.value=e.data.user,o.value=e.data.user,a||console.log("âœ… User authenticated:",s.value.email,"role:",s.value.role),s.value):(a||console.log("âŒ Invalid response from auth API"),s.value=null,o.value=null,null)}catch(e){return!a&&401!==e.statusCode&&console.error("âŒ Auth check error:",e),s.value=null,o.value=null,401===e.statusCode&&(l.value=null,a||console.log("ðŸ”’ Cleared invalid token")),null}},refreshUser:async()=>{if(!s.value)return null;try{const e=await $fetch("/api/auth/me");return e.success&&e.data.user?(s.value=e.data.user,o.value=e.data.user,s.value):(s.value=null,o.value=null,null)}catch(e){return console.error("Refresh user error:",e),s.value=null,o.value=null,null}},hasPermission:e=>!(!s.value||!s.value.permissions)&&!0===s.value.permissions[e],hasRole:n}};export{_};
//# sourceMappingURL=useAuth.mjs.map
