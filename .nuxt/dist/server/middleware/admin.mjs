import{executeAsync as c}from"F:/TravelinAgency/node_modules/unctx/dist/index.mjs";import{defineNuxtRouteMiddleware as s,navigateTo as i}from"../node_modules/nuxt/dist/app/composables/router.mjs";import{useAuth as d}from"../composables/useAuth.mjs";const f=s(async r=>{let o,l;console.log("ğŸš€ Admin middleware called for:",r.path);const{user:n,checkAuth:t}=d();if(r.path==="/admin/login"){console.log("â­ï¸ Skipping middleware for login page");return}let e=n.value;if(e)console.log("âœ… User already authenticated from cookie:",e.email);else{console.log("ğŸ‘¤ No user in state, checking auth...");try{e=([o,l]=c(()=>t(!0)),o=await o,l(),o)}catch(a){return console.error("âŒ Auth check failed:",a),i("/admin/login")}}if(!e||!e.role||!["admin","super_admin","moderator"].includes(e.role))return console.log("âŒ No authenticated admin user found, redirecting to login"),i("/admin/login");console.log("âœ… User has admin privileges:",e.email,"role:",e.role),console.log("âœ… Middleware completed successfully for:",r.path)});export{f as default};
//# sourceMappingURL=admin.mjs.map
