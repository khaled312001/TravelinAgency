import{computed as e,defineComponent as i,useAttrs as o,ref as n,unref as a,mergeProps as d}from"vue";import{ssrRenderSlot as l,ssrRenderAttrs as c}from"vue/server-renderer";import{C as p}from"../_/nitro.mjs";import{g as f,a as m,Y as g,O as v,c as w,d as b,T as q,S as x,H as $}from"./server.mjs";async function h(e,i){return await async function(e){{const i=(await import("image-meta").then((e=>e.imageMeta)))(await fetch(e).then((e=>e.buffer())));if(!i)throw new Error(`No metadata could be extracted from the image \`${e}\`.`);const{width:o,height:n}=i;return{width:o,height:n,ratio:o&&n?o/n:void 0}}}(i).catch((e=>(console.error("Failed to get image meta for "+i,e+""),{width:0,height:0,ratio:0})))}function u(e){return i=>i?e[i]||i:e.missingValue}function l$2(e=""){return"number"==typeof e?e:"string"==typeof e&&e.replace("px","").match(/^\d+$/g)?Number.parseInt(e,10):void 0}function K(e){const i={options:e},r=(e,o={})=>k(i,e,o),t=(e,i={},o={})=>r(e,{...o,modifiers:p(i,o.modifiers||{})}).url;for(const i in e.presets)t[i]=(o,n,a)=>t(o,n,{...e.presets[i],...a});return t.options=e,t.getImage=r,t.getMeta=(e,o)=>async function(e,i,o){const n=k(e,i,{...o});return"function"==typeof n.getMeta?await n.getMeta():await h(0,n.url)}(i,e,o),t.getSizes=(e,o)=>function(e,i,o){var n,a,d,l,c;const p=l$2(null==(n=o.modifiers)?void 0:n.width),f=l$2(null==(a=o.modifiers)?void 0:a.height),m=function(e){const i={};if("string"==typeof e)for(const o of e.split(/[\s,]+/).filter((e=>e))){const e=o.split(":");2!==e.length?i["1px"]=e[0].trim():i[e[0].trim()]=e[1].trim()}else Object.assign(i,e);return i}(o.sizes),g=null!=(d=o.densities)&&d.trim()?function(e=""){if(void 0===e||!e.length)return[];const i=new Set;for(const o of e.split(" ")){const e=Number.parseInt(o.replace("x",""));e&&i.add(e)}return Array.from(i)}(o.densities.trim()):e.options.densities;!function(e){if(0===e.length)throw new Error("`densities` must not be empty, configure to `1` to render regular size only (DPR 1.0)")}(g);const v=p&&f?f/p:0,w=[],b=[];if(Object.keys(m).length>=1){for(const n in m){const a=y(n,String(m[n]),f,v,e);if(void 0!==a){w.push({size:a.size,screenMaxWidth:a.screenMaxWidth,media:`(max-width: ${a.screenMaxWidth}px)`});for(const n of g)b.push({width:a._cWidth*n,src:_(e,i,o,a,n)})}}!function(e){var i;e.sort(((e,i)=>e.screenMaxWidth-i.screenMaxWidth));let o=null;for(let i=e.length-1;i>=0;i--){const n=e[i];n.media===o&&e.splice(i,1),o=n.media}for(let o=0;o<e.length;o++)e[o].media=(null==(i=e[o+1])?void 0:i.media)||""}(w)}else for(const n of g){const a=Object.keys(m)[0];let d=a?y(a,String(m[a]),f,v,e):void 0;void 0===d&&(d={size:"",screenMaxWidth:0,_cWidth:null==(l=o.modifiers)?void 0:l.width,_cHeight:null==(c=o.modifiers)?void 0:c.height}),b.push({width:n,src:_(e,i,o,d,n)})}!function(e){e.sort(((e,i)=>e.width-i.width));let i=null;for(let o=e.length-1;o>=0;o--){const n=e[o];n.width===i&&e.splice(o,1),i=n.width}}(b);const q=b[b.length-1],x=w.length?w.map((e=>`${e.media?e.media+" ":""}${e.size}`)).join(", "):void 0,$=x?"w":"x",S=b.map((e=>`${e.src} ${e.width}${$}`)).join(", ");return{sizes:x,srcset:S,src:null==q?void 0:q.src}}(i,e,o),i.$img=t,t}function k(e,i,o){var n,a;if(i&&"string"!=typeof i)throw new TypeError(`input must be a string (received ${typeof i}: ${JSON.stringify(i)})`);if(!i||i.startsWith("data:"))return{url:i};const{provider:d,defaults:l}=function(e,i){const o=e.options.providers[i];if(!o)throw new Error("Unknown provider: "+i);return o}(e,o.provider||e.options.provider),c=function(e,i){if(!i)return{};if(!e.options.presets[i])throw new Error("Unknown preset: "+i);return e.options.presets[i]}(e,o.preset);if(i=m(i)?i:f(i),!d.supportsAlias)for(const o in e.options.alias)if(i.startsWith(o)){const n=e.options.alias[o];n&&(i=g(n,i.slice(o.length)))}if(d.validateDomains&&m(i)){const o=v(i).host;if(!e.options.domains.find((e=>e===o)))return{url:i}}const w=p(o,c,l);w.modifiers={...w.modifiers};const b=w.modifiers.format;null!=(n=w.modifiers)&&n.width&&(w.modifiers.width=l$2(w.modifiers.width)),null!=(a=w.modifiers)&&a.height&&(w.modifiers.height=l$2(w.modifiers.height));const q=d.getImage(i,w,e);return q.format=q.format||b||"",q}function y(e,i,o,n,a){const d=a.options.screens&&a.options.screens[e]||Number.parseInt(e),l=i.endsWith("vw");if(!l&&/^\d+$/.test(i)&&(i+="px"),!l&&!i.endsWith("px"))return;let c=Number.parseInt(i);if(!d||!c)return;l&&(c=Math.round(c/100*d));return{size:i,screenMaxWidth:d,_cWidth:c,_cHeight:n?Math.round(c*n):o}}function _(e,i,o,n,a){return e.$img(i,{...o.modifiers,width:n._cWidth?n._cWidth*a:void 0,height:n._cHeight?n._cHeight*a:void 0},o)}const S=function({formatter:e,keyMap:i,joinWith:o="/",valueMap:n}={}){e||(e=(e,i)=>`${e}=${i}`),i&&"function"!=typeof i&&(i=u(i));const a=n||{};return Object.keys(a).forEach((e=>{"function"!=typeof a[e]&&(a[e]=u(a[e]))})),(n={})=>Object.entries(n).filter((([e,i])=>typeof i<"u")).map((([o,d])=>{const l=a[o];return"function"==typeof l&&(d=l(n[o])),o="function"==typeof i?i(o):o,e(o,d)})).join(o)}({keyMap:{format:"f",fit:"fit",width:"w",height:"h",resize:"s",quality:"q",background:"b"},joinWith:"&",formatter:(e,i)=>b(e)+"_"+b(i)}),z=Object.freeze({__proto__:null,getImage:(e,{modifiers:i={},baseURL:o}={},n)=>{i.width&&i.height&&(i.resize=`${i.width}x${i.height}`,delete i.width,delete i.height);const a=S(i)||"_";return o||(o=g(n.options.nuxt.baseURL,"/_ipx")),{url:g(o,a,w(e))}},supportsAlias:!0,validateDomains:!0}),j={screens:{xs:320,sm:640,md:768,lg:1024,xl:1280,xxl:1536,"2xl":1536},presets:{default:{modifiers:{format:"webp",quality:80}}},provider:"ipx",domains:["images.unsplash.com","images.pexels.com"],alias:{},densities:[1,2,1,2],format:["jpg","jpeg","png","webp","webp"],quality:80};j.providers={ipx:{provider:z,defaults:{}}};const s=()=>{const e=q(),i=x();return i.$img||i._img||(i._img=K({...j,nuxt:{baseURL:e.app.baseURL},runtimeConfig:e}))},W={src:{type:String,required:!1},format:{type:String,required:!1},quality:{type:[Number,String],required:!1},background:{type:String,required:!1},fit:{type:String,required:!1},modifiers:{type:Object,required:!1},preset:{type:String,required:!1},provider:{type:String,required:!1},sizes:{type:[Object,String],required:!1},densities:{type:String,required:!1},preload:{type:[Boolean,Object],required:!1},width:{type:[String,Number],required:!1},height:{type:[String,Number],required:!1},alt:{type:String,required:!1},referrerpolicy:{type:String,required:!1},usemap:{type:String,required:!1},longdesc:{type:String,required:!1},ismap:{type:Boolean,required:!1},loading:{type:String,required:!1,validator:e=>["lazy","eager"].includes(e)},crossorigin:{type:[Boolean,String],required:!1,validator:e=>["anonymous","use-credentials","",!0,!1].includes(e)},decoding:{type:String,required:!1,validator:e=>["async","auto","sync"].includes(e)},nonce:{type:[String],required:!1}},M=i({__name:"NuxtImg",__ssrInlineRender:!0,props:{...W,placeholder:{type:[Boolean,String,Number,Array],required:!1},placeholderClass:{type:String,required:!1},custom:{type:Boolean,required:!1}},emits:["load","error"],setup(i,{emit:p}){const f=i,m=o(),g=!0,v=s(),w=(i=>{const o=e((()=>({provider:i.provider,preset:i.preset}))),n=e((()=>({width:l$2(i.width),height:l$2(i.height),alt:i.alt,referrerpolicy:i.referrerpolicy,usemap:i.usemap,longdesc:i.longdesc,ismap:i.ismap,crossorigin:!0===i.crossorigin?"anonymous":i.crossorigin||void 0,loading:i.loading,decoding:i.decoding,nonce:i.nonce}))),a=s();return{options:o,attrs:n,modifiers:e((()=>({...i.modifiers,width:l$2(i.width),height:l$2(i.height),format:i.format,quality:i.quality||a.options.quality,background:i.background,fit:i.fit})))}})(f),b=n(!1),q=n(),S=e((()=>v.getSizes(f.src,{...w.options.value,sizes:f.sizes,densities:f.densities,modifiers:{...w.modifiers.value,width:l$2(f.width),height:l$2(f.height)}}))),z=e((()=>{const e={...w.attrs.value,"data-nuxt-img":""};return(!f.placeholder||b.value)&&(e.sizes=S.value.sizes,e.srcset=S.value.srcset),e})),j=e((()=>{let e=f.placeholder;if(""===e&&(e=!0),!e||b.value)return!1;if("string"==typeof e)return e;const i=Array.isArray(e)?e:"number"==typeof e?[e,e]:[10,10];return v(f.src,{...w.modifiers.value,width:i[0],height:i[1],quality:i[2]||50,blur:i[3]||3},w.options.value)})),W=e((()=>f.sizes?S.value.src:v(f.src,w.modifiers.value,w.options.value))),M=e((()=>j.value?j.value:W.value));if(f.preload){const e=Object.values(S.value).every((e=>e));$({link:[{rel:"preload",as:"image",nonce:f.nonce,...e?{href:S.value.src,imagesizes:S.value.sizes,imagesrcset:S.value.srcset}:{href:M.value},..."boolean"!=typeof f.preload&&f.preload.fetchPriority?{fetchpriority:f.preload.fetchPriority}:{}}]})}return x().isHydrating,(e,i,o,n)=>{e.custom?l(e.$slots,"default",{...a(g)?{onerror:"this.setAttribute('data-error', 1)"}:{},imgAttrs:{...z.value,...a(m)},isLoaded:b.value,src:M.value},null,i,o):i(`<img${c(d({ref_key:"imgEl",ref:q,class:j.value&&!b.value?e.placeholderClass:void 0},{...a(g)?{onerror:"this.setAttribute('data-error', 1)"}:{},...z.value,...a(m)},{src:M.value},n))}>`)}}});export{M as G};
//# sourceMappingURL=NuxtImg.vue2.mjs.map
