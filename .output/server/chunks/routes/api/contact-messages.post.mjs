import{c as e,r as s,e as t,j as o,k as a}from"../../_/nitro.mjs";import{executeQuery as n}from"../../_/database.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"vue";import"node:fs";import"node:url";import"@iconify/utils";import"node:crypto";import"consola";import"node:module";import"ipx";import"node:path";import"mysql2/promise";import"bcryptjs";import"jsonwebtoken";const r=e((async e=>{try{const r=await s(e),{name:c,email:i,phone:m,subject:l,message:d,type:p="general",source:u="website",related_package_id:g=null,related_destination_id:_=null}=r;if(!c||!d)throw t({statusCode:400,statusMessage:"Name and message are required"});console.log("ğŸ“§ Contact message received:",{name:c,email:i||null,phone:m||null,subject:l||"Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ø§Ù…",message:d,type:p,source:u,related_package_id:g,related_destination_id:_});try{const s=await n("\n        INSERT INTO contact_messages (\n          name, email, phone, subject, message, type, status, source,\n          related_package_id, related_destination_id, ip_address, user_agent, created_at, updated_at\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW(), NOW())\n      ",[c,i||null,m||null,l||"Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ø§Ù…",d,p,"new",u,g,_,o(e,{xForwardedFor:!0})||"127.0.0.1",a(e,"user-agent")||"Unknown"]);return console.log("âœ… Database insert successful:",s),{success:!0,message:"Contact message submitted successfully",id:s.insertId||"success"}}catch(e){return console.warn("âš ï¸ Database connection failed, using development fallback:",e.message),console.log("ğŸ“ Development mode: Contact message logged to console"),console.log("ğŸ“§ Contact Details:",{name:c,email:i,phone:m,subject:l||"Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ø§Ù…",message:d,type:p,source:u,timestamp:(new Date).toISOString()}),{success:!0,message:"Contact message received successfully (development mode)",id:"dev-"+Date.now()}}}catch(e){if(console.error("âŒ Error processing contact message:",e),e.statusCode)throw e;throw t({statusCode:500,statusMessage:"Failed to process contact message"})}}));export{r as default};
//# sourceMappingURL=contact-messages.post.mjs.map
